"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useAsObservable = void 0;
var rxjs_1 = require("rxjs");
var react_1 = require("react");
var useIsomorphicEffect_1 = require("./useIsomorphicEffect");
var operators_1 = require("rxjs/operators");
function useAsObservable(value, operator) {
    var setup = (0, react_1.useCallback)(function () {
        var subject = new rxjs_1.BehaviorSubject(value);
        var observable = subject.asObservable().pipe((0, operators_1.distinctUntilChanged)());
        return [operator ? observable.pipe(operator) : observable, subject];
    }, []);
    var ref = (0, react_1.useRef)();
    if (!ref.current) {
        ref.current = setup();
    }
    var observable = ref.current[0];
    (0, useIsomorphicEffect_1.useIsomorphicEffect)(function () {
        if (!ref.current) {
            return;
        }
        var _a = ref.current, subject = _a[1];
        subject.next(value);
    }, [value, ref]);
    (0, useIsomorphicEffect_1.useIsomorphicEffect)(function () {
        return function () {
            if (!ref.current) {
                return;
            }
            var _a = ref.current, subject = _a[1];
            subject.complete();
            ref.current = undefined;
        };
    }, []);
    return observable;
}
exports.useAsObservable = useAsObservable;
