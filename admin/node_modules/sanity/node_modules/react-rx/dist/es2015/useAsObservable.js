import { BehaviorSubject } from 'rxjs';
import { useCallback, useRef } from 'react';
import { useIsomorphicEffect } from './useIsomorphicEffect';
import { distinctUntilChanged } from 'rxjs/operators';
export function useAsObservable(value, operator) {
    const setup = useCallback(() => {
        const subject = new BehaviorSubject(value);
        const observable = subject.asObservable().pipe(distinctUntilChanged());
        return [operator ? observable.pipe(operator) : observable, subject];
    }, []);
    const ref = useRef();
    if (!ref.current) {
        ref.current = setup();
    }
    const [observable] = ref.current;
    useIsomorphicEffect(() => {
        if (!ref.current) {
            return;
        }
        const [, subject] = ref.current;
        subject.next(value);
    }, [value, ref]);
    useIsomorphicEffect(() => {
        return () => {
            if (!ref.current) {
                return;
            }
            const [, subject] = ref.current;
            subject.complete();
            ref.current = undefined;
        };
    }, []);
    return observable;
}
