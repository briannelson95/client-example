"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.collectLatestAuthorAnnotations = collectLatestAuthorAnnotations;

var _field = require("../../../../field");

function collectLatestAuthorAnnotations(diff) {
  const authorMap = new Map();
  (0, _field.visitDiff)(diff, child => {
    if (child.action === 'unchanged' || !('annotation' in child) || !child.annotation) {
      return true;
    }

    const {
      author,
      timestamp
    } = child.annotation;
    const previous = authorMap.get(author);

    if (!previous || previous.timestamp < timestamp) {
      authorMap.set(author, child.annotation);
    }

    return true;
  });
  return Array.from(authorMap.values()).sort((a, b) => a.timestamp < b.timestamp ? 1 : -1);
}