"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureDocumentIdAndType = ensureDocumentIdAndType;
exports.removeDraftPrefix = removeDraftPrefix;

var _uuid = require("@sanity/uuid");

var _operators = require("rxjs/operators");

var _structureResolvers = require("../../../structureResolvers");

var _util = require("../../../../util");

function removeDraftPrefix(documentId) {
  const publishedId = (0, _util.getPublishedId)(documentId);

  if (publishedId !== documentId) {
    console.warn('Removed unexpected draft id in document link: All links to documents should have the ' + '`drafts.`-prefix removed and something appears to have made an intent link to `%s`', documentId);
  }

  return publishedId;
}

async function ensureDocumentIdAndType(documentStore, id, type) {
  if (id && type) return {
    id,
    type
  };
  if (!id && type) return {
    id: (0, _uuid.uuid)(),
    type
  };

  if (id && !type) {
    const resolvedType = await documentStore.resolveTypeForDocument(id).pipe((0, _operators.first)()).toPromise();
    return {
      id,
      type: resolvedType
    };
  }

  throw new _structureResolvers.PaneResolutionError({
    message: 'Neither document `id` or `type` was provided when trying to resolve intent.'
  });
}