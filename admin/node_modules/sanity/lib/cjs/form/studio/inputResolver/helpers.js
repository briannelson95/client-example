"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getArrayFieldLevel = getArrayFieldLevel;
exports.getObjectFieldLevel = getObjectFieldLevel;
exports.getOption = getOption;

var _get2 = _interopRequireDefault(require("lodash/get"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getOption(type, optionName) {
  return (0, _get2.default)(type.options, optionName);
}

const PSEUDO_OBJECTS = ['array', 'file', 'image', 'reference'];
const HIDDEN_FIELDS = ['asset', 'crop', 'hotspot', '_ref', '_weak'];
const NO_LEVEL_LAYOUTS = ['tags'];

function getObjectFieldLevel(field) {
  var _options$list;

  const {
    type,
    fields,
    options
  } = field.schemaType;
  const fieldType = (type === null || type === void 0 ? void 0 : type.name) || '';
  const isPseudoObject = PSEUDO_OBJECTS.includes(fieldType);
  const hasVisibleFields = (fields === null || fields === void 0 ? void 0 : fields.filter(f => !HIDDEN_FIELDS.includes(f.name)).length) > 0;
  const hasListOptions = (options === null || options === void 0 ? void 0 : (_options$list = options.list) === null || _options$list === void 0 ? void 0 : _options$list.length) > 0;

  if (hasVisibleFields || hasListOptions || !isPseudoObject) {
    return field.level;
  }

  return 0;
}

function getArrayFieldLevel(field) {
  var _ref;

  const {
    options
  } = field.schemaType;
  const hasListOptions = ((_ref = (options === null || options === void 0 ? void 0 : options.list) || []) === null || _ref === void 0 ? void 0 : _ref.length) > 0;
  const isNoLevelLayout = NO_LEVEL_LAYOUTS.includes((options === null || options === void 0 ? void 0 : options.layout) || '');

  if (hasListOptions && !isNoLevelLayout) {
    return field.level;
  }

  return 0;
}