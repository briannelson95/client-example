"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useCrossProjectToken = useCrossProjectToken;

var _reactRx = require("react-rx");

var _operators = require("rxjs/operators");

var _datastores = require("../../../../../datastores");

var _util = require("../../../../../util");

function useCrossProjectToken(client, _ref) {
  let {
    projectId,
    tokenId
  } = _ref;
  const documentPreviewStore = (0, _datastores.useDocumentPreviewStore)();
  const crossProjectTokenStore = (0, _datastores.useCrossProjectTokenStore)();
  return (0, _reactRx.useMemoObservable)(() => {
    return documentPreviewStore.observePaths({
      _type: 'reference',
      _ref: crossProjectTokenStore.getTokenDocumentId({
        projectId,
        tokenId
      })
    }, ['token']).pipe((0, _operators.map)(documentValue => {
      const value = (0, _util.isRecord)(documentValue) ? documentValue : undefined;
      return {
        status: 'loaded',
        result: typeof (value === null || value === void 0 ? void 0 : value.token) === 'string' ? value === null || value === void 0 ? void 0 : value.token : undefined
      };
    }), (0, _operators.startWith)({
      status: 'loading'
    }));
  }, [client, crossProjectTokenStore, documentPreviewStore, projectId, tokenId]);
}