"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createInsertCallback = createInsertCallback;

var _blockTools = require("@sanity/block-tools");

var _patch = require("../../../patch");

function createInsertCallback(options) {
  const {
    allowedDecorators,
    block,
    onChange
  } = options;
  let toInsert;
  return givenBlock => {
    toInsert = Array.isArray(givenBlock) ? givenBlock : [givenBlock];
    toInsert = toInsert.map(blk => (0, _blockTools.normalizeBlock)(blk, {
      allowedDecorators
    }));
    const patches = [(0, _patch.insert)(toInsert, 'after', [{
      _key: block._key
    }])];
    return onChange(patches);
  };
}