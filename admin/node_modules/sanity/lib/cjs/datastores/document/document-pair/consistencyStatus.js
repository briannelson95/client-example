"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.consistencyStatus = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _createMemoizer = require("../utils/createMemoizer");

var _memoizedPair = require("./memoizedPair");

// A stream of all events related to either published or draft, each event comes with a 'target'
// that specifies which version (draft|published) the event is about
const consistencyStatus = (0, _createMemoizer.memoize)((client, idPair, typeName) => {
  return (0, _memoizedPair.memoizedPair)(client, idPair, typeName).pipe((0, _operators.switchMap)(_ref => {
    let {
      draft,
      published
    } = _ref;
    return (0, _rxjs.combineLatest)([draft.consistency$, published.consistency$]);
  }), (0, _operators.map)(_ref2 => {
    let [draftIsConsistent, publishedIsConsistent] = _ref2;
    return draftIsConsistent && publishedIsConsistent;
  }), (0, _operators.distinctUntilChanged)(), (0, _operators.publishReplay)(1), (0, _operators.refCount)());
}, (_client, idPair, typeName) => idPair.publishedId + typeName);
exports.consistencyStatus = consistencyStatus;