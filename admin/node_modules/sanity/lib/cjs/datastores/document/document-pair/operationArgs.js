"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.operationArgs = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _createMemoizer = require("../utils/createMemoizer");

var _snapshotPair = require("./snapshotPair");

/* eslint-disable @typescript-eslint/no-use-before-define */
const operationArgs = (0, _createMemoizer.memoize)((ctx, idPair, typeName) => {
  return (0, _snapshotPair.snapshotPair)(ctx.client, idPair, typeName).pipe((0, _operators.switchMap)(versions => (0, _rxjs.combineLatest)([versions.draft.snapshots$, versions.published.snapshots$]).pipe((0, _operators.map)(_ref => {
    let [draft, published] = _ref;
    return { ...ctx,
      idPair,
      typeName: typeName,
      snapshots: {
        draft,
        published
      },
      draft: versions.draft,
      published: versions.published
    };
  }))), (0, _operators.publishReplay)(1), (0, _operators.refCount)());
}, (_ctx, idPair, typeName) => idPair.publishedId + typeName);
exports.operationArgs = operationArgs;