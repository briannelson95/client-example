"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.duplicate = void 0;

var _omit2 = _interopRequireDefault(require("lodash/omit"));

var _draftUtils = require("../../../../util/draftUtils");

var _isLiveEditEnabled = require("../utils/isLiveEditEnabled");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const omitProps = ['_createdAt', '_updatedAt'];
const duplicate = {
  disabled: _ref => {
    let {
      snapshots
    } = _ref;
    return snapshots.published || snapshots.draft ? false : 'NOTHING_TO_DUPLICATE';
  },
  execute: (_ref2, dupeId) => {
    let {
      client,
      schema,
      snapshots,
      typeName
    } = _ref2;
    const source = snapshots.draft || snapshots.published;

    if (!source) {
      throw new Error('cannot execute on empty document');
    }

    return client.observable.create({ ...(0, _omit2.default)(source, omitProps),
      _id: (0, _isLiveEditEnabled.isLiveEditEnabled)(schema, typeName) ? dupeId : (0, _draftUtils.getDraftId)(dupeId),
      _type: source._type
    }, {
      visibility: 'async',
      tag: 'document.duplicate'
    });
  }
};
exports.duplicate = duplicate;