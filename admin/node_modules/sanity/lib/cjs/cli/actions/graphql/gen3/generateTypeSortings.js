"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateTypeSortings = generateTypeSortings;

var _helpers = require("../helpers");

const builtInTypes = ['Boolean', 'Date', 'Datetime', 'Email', 'Float', 'ID', 'Integer', 'String', 'Text', 'Url'];
const builtInSortingEnum = {
  name: 'SortOrder',
  kind: 'Enum',
  values: [{
    name: 'ASC',
    description: 'Sorts on the value in ascending order.',
    value: 1
  }, {
    name: 'DESC',
    description: 'Sorts on the value in descending order.',
    value: 2
  }]
};

function generateTypeSortings(types) {
  const objectTypes = types.filter(_helpers.isNonUnion).filter(type => type.type === 'Object' && !['Block', 'Span'].includes(type.name) && // TODO: What do we do with blocks?
  !type.interfaces && !builtInTypes.includes(type.name));
  const documentTypes = types.filter(type => type.name === 'Document' || (0, _helpers.isDocumentType)(type));

  const hasFields = type => type.fields.length > 0;

  const objectTypeSortings = createObjectTypeSortings(objectTypes);
  const documentTypeSortings = createDocumentTypeSortings(documentTypes);
  const allSortings = [...objectTypeSortings, ...documentTypeSortings].filter(hasFields);
  return [...allSortings, builtInSortingEnum];
}

function createObjectTypeSortings(objectTypes) {
  return objectTypes.map(objectType => ({
    name: "".concat(objectType.name, "Sorting"),
    kind: 'InputObject',
    fields: objectType.fields.filter(field => field.type !== 'JSON' && field.kind !== 'List').filter(field => !field.isReference).map(field => ({
      fieldName: field.fieldName,
      type: builtInTypes.includes(field.type) ? builtInSortingEnum.name : "".concat(field.type, "Sorting")
    }))
  }));
}

function createDocumentTypeSortings(documentTypes) {
  return documentTypes.map(documentType => ({
    name: "".concat(documentType.name, "Sorting"),
    kind: 'InputObject',
    fields: documentType.fields.filter(field => field.type !== 'JSON' && field.kind !== 'List').filter(field => !field.isReference).map(field => ({
      fieldName: field.fieldName,
      type: builtInTypes.includes(field.type) ? builtInSortingEnum.name : "".concat(field.type, "Sorting")
    }))
  }));
}