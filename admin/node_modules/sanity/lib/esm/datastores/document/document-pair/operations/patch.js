import { isLiveEditEnabled } from '../utils/isLiveEditEnabled'; // todo: we could also consider exposing 'mutate' directly

export const patch = {
  disabled: () => false,
  execute: function (_ref) {
    let {
      schema,
      snapshots,
      idPair,
      draft,
      published,
      typeName
    } = _ref;
    let patches = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
    let initialValue = arguments.length > 2 ? arguments[2] : undefined;

    if (isLiveEditEnabled(schema, typeName)) {
      // No drafting, so patch and commit the published document
      published.mutate([published.createIfNotExists({
        _type: typeName,
        ...initialValue
      }), ...published.patch(patches)]);
    } else {
      draft.mutate([draft.createIfNotExists({ ...initialValue,
        ...snapshots.published,
        _id: idPair.draftId,
        _type: typeName
      }), ...draft.patch(patches)]);
    }
  }
};