import React, { useCallback, useEffect, useMemo, useState } from 'react';
import { useSource } from '../../../../../studio';
import { applyAll } from '../../../../patch/simplePatch';
import { createPatchChannel } from '../../../../patch/PatchChannel';
export function TestInput(props) {
  const {
    markers: markersProp = [],
    validation: validationProp = [],
    readOnly = false,
    renderBlockActions,
    renderCustomMarkers,
    type,
    value: valueProp = [],
    withError = false,
    withWarning = false,
    withCustomMarkers = false
  } = props;
  const {
    form
  } = useSource();
  const [value, setValue] = useState(valueProp);
  const [focusPath, setFocusPath] = useState([]);
  const blockType = useMemo(() => {
    var _type$of;

    return (_type$of = type.of) === null || _type$of === void 0 ? void 0 : _type$of.find(t => {
      var _t$type;

      return ((_t$type = t.type) === null || _t$type === void 0 ? void 0 : _t$type.name) === 'block';
    });
  }, [type]);
  const presence = useMemo(() => [], []);
  const hotkeys = useMemo(() => ({}), []);
  const [markers, setMarkers] = useState([]);
  const [validation, setValidation] = useState([]); // const resolveInputComponent: FormInputComponentResolver = useCallback(
  //   (_type) => inputResolver(_type, form),
  //   [form]
  // )

  const onFocus = useCallback(pathOrEvent => {
    setFocusPath(Array.isArray(pathOrEvent) ? pathOrEvent : []);
  }, []);
  const onBlur = useCallback(() => {
    setFocusPath([]);
  }, []);
  const onChange = useCallback(event => {
    setValue(prevValue => applyAll(prevValue, event.patches));
  }, []); // useEffect(() => {
  //   if (value) {
  //     const newValidation = [...validationProp]
  //     const newMarkers = [...markersProp]
  //     value.forEach((blk) => {
  //       if (blk._type === blockType.name) {
  //         const inline = blk.children.find((child) => child._type !== 'span')
  //         const annotation = blk.markDefs[0]
  //         if (inline) {
  //           if (withError) {
  //             newValidation.push({
  //               level: 'error',
  //               path: [{_key: blk._key}, 'children', {_key: inline._key}],
  //               item: {message: 'There is an error with this inline object'},
  //             })
  //           }
  //           if (withWarning) {
  //             newValidation.push({
  //               level: 'warning',
  //               path: [{_key: blk._key}, 'children', {_key: inline._key}],
  //               item: {message: 'This is a warning'},
  //             })
  //           }
  //           if (withCustomMarkers) {
  //             newMarkers.push({
  //               type: 'customMarkerTest',
  //               path: [{_key: blk._key}, 'children', {_key: inline._key}],
  //             })
  //           }
  //         } else if (annotation) {
  //           if (withError) {
  //             newValidation.push({
  //               level: 'error',
  //               path: [{_key: blk._key}, 'markDefs', {_key: annotation._key}],
  //               item: {message: 'There an error with this annotation'},
  //             })
  //           }
  //           if (withWarning) {
  //             newValidation.push({
  //               level: 'warning',
  //               path: [{_key: blk._key}, 'markDefs', {_key: annotation._key}],
  //               item: {message: 'This is a warning'},
  //             })
  //           }
  //           if (withCustomMarkers) {
  //             newMarkers.push({
  //               type: 'customMarkerTest',
  //               path: [{_key: blk._key}, 'markDefs', {_key: annotation._key}],
  //             })
  //           }
  //         } else {
  //           if (withError) {
  //             newValidation.push({
  //               level: 'error',
  //               path: [{_key: blk._key}],
  //               item: {message: 'There is an error with this textblock'},
  //             })
  //           }
  //           if (withWarning) {
  //             newValidation.push({
  //               level: 'warning',
  //               path: [{_key: blk._key}],
  //               item: {message: 'This is a warning'},
  //             })
  //           }
  //           if (withCustomMarkers) {
  //             newMarkers.push({
  //               type: 'customMarkerTest',
  //               path: [{_key: blk._key}],
  //             })
  //           }
  //         }
  //       } else {
  //         if (withError) {
  //           newValidation.push({
  //             level: 'error',
  //             path: [{_key: blk._key}, 'title'],
  //             item: {message: 'There is an error with this object block'},
  //           })
  //         }
  //         if (withWarning) {
  //           newValidation.push({
  //             level: 'warning',
  //             path: [{_key: blk._key}, 'title'],
  //             item: {message: 'This is a warning'},
  //           })
  //         }
  //         if (withCustomMarkers) {
  //           newMarkers.push({
  //             type: 'customMarkerTest',
  //             path: [{_key: blk._key}],
  //           })
  //         }
  //       }
  //     })
  //     setMarkers(newMarkers)
  //     setValidation(newValidation)
  //   }
  //   if (!withError && !withCustomMarkers && !withWarning) {
  //     setMarkers(markersProp)
  //     setValidation(validationProp)
  //   }
  // }, [blockType, markersProp, validationProp, value, withCustomMarkers, withError, withWarning])

  const patchChannel = useMemo(() => createPatchChannel(), []);
  useEffect(() => {
    setValue(props.value || []);
  }, [props.value]);
  return /*#__PURE__*/React.createElement(React.Fragment, null, "TODO"); // return (
  //   <FormBuilderProvider
  //     __internal_patchChannel={patchChannel}
  //     onChange={onChange}
  //     value={value}
  //     {...formBuilder}
  //   >
  //     <ReviewChangesContextProvider changesOpen={false}>
  //       {/* <Box
  //         style={{
  //          width: '300px',
  //          height: '300px',
  //          position: 'absolute',
  //          bottom: 0,
  //          zIndex: 9999,
  //          padding: 10,
  //          left: 0,
  //         }}
  //         >
  //         <Box marginBottom={3}>
  //          <Heading size={1}>FocusPath</Heading>
  //         </Box>
  //         <Box>
  //          <Code size={5}>{JSON.stringify(focusPath, null, 2)}</Code>
  //         </Box>
  //         </Box> */}
  //       <>TODO</>
  //       {/* <PortableTextInput
  //         focusPath={focusPath}
  //         hotkeys={hotkeys}
  //         level={1}
  //         markers={markers}
  //         validation={validation}
  //         onBlur={onBlur}
  //         onChange={onChange}
  //         onFocus={onFocus}
  //         presence={presence}
  //         readOnly={readOnly}
  //         renderBlockActions={renderBlockActions}
  //         renderCustomMarkers={renderCustomMarkers}
  //         type={props.type as any}
  //         value={value}
  //       /> */}
  //     </ReviewChangesContextProvider>
  //   </FormBuilderProvider>
  // )
}